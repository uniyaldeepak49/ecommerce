<!-- === HEADER SHELL === -->
<mat-sidenav-container class="header-shell">
  <!-- ===== MOBILE DRAWER ===== -->
  <mat-sidenav
    #drawer
    mode="over"
    [fixedInViewport]="false"
    class="drawer"
  >
    <div class="drawer-header">
      <a routerLink="/" class="brand-link">
        <mat-icon>shopping_bag</mat-icon>
        <span>{{ brand }}</span>
      </a>
      <button mat-icon-button (click)="drawer.close()" aria-label="Close">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Drawer search -->
    <mat-form-field appearance="outline" class="search">
      <mat-icon matPrefix>search</mat-icon>
      <input
        matInput
        placeholder="Search for products, brands and more"
        [matAutocomplete]="autoDesk"
        [formControl]="searchCtrl"
      />
    </mat-form-field>

    <!-- Drawer nav (sections) -->
    <mat-nav-list>
      <a mat-list-item routerLink="/" (click)="drawer.close()">
        <mat-icon matListItemIcon>home</mat-icon> Home
      </a>

      @for (item of nav; track item.label) {
        @if (!item.children?.length) {
          <a mat-list-item [routerLink]="item.route" (click)="drawer.close()">
            @if (item.icon) {
              <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
            }
            {{ item.label }}
          </a>
        } @else {
          <div class="drawer-section">{{ item.label }}</div>
          @for (c of item.children; track c.label) {
            <a mat-list-item [routerLink]="c.route" (click)="drawer.close()">
              {{ c.label }}
              @if (c.description) {
                <div matListItemLine>{{ c.description }}</div>
              }
            </a>
          }
          <mat-divider></mat-divider>
        }
      }
    </mat-nav-list>
  </mat-sidenav>

  <!-- ===== CONTENT ===== -->
  <mat-sidenav-content>
    <!-- === TOP UTILITY BAR (compact like Flipkart) === -->
    <div class="util hide-handset">
      <div class="util-left">
        @if (promo) {
          <button mat-button class="promo-btn" disableRipple>
            <mat-icon inline>local_shipping</mat-icon>
            <span>{{ promo }}</span>
          </button>
        }
      </div>

      <div class="util-right">
        <button mat-button routerLink="/help">Help</button>
        <button mat-button routerLink="/track">Track Order</button>
        <button mat-button routerLink="/stores">Stores</button>

        <!-- Country (menu â€“ compact) -->

        <!-- Country -->
        <button mat-button [matMenuTriggerFor]="countryMenu" aria-label="Select country">
          <mat-icon>public</mat-icon>
          {{ countryLabel() }}
          <mat-icon>expand_more</mat-icon>
        </button>
        <mat-menu #countryMenu="matMenu" class="country-menu" xPosition="before">
          @for (c of countries; track c.code) {
            <button mat-menu-item (click)="country.set(c.code)">
              <mat-icon>flag</mat-icon>
              {{ c.label }}
            </button>
          }
        </mat-menu>

        <!-- Currency -->
        <button mat-button [matMenuTriggerFor]="currencyMenu" aria-label="Select currency">
          <mat-icon>attach_money</mat-icon>
          {{ currencyLabel() }}
          <mat-icon>expand_more</mat-icon>
        </button>
        <mat-menu #currencyMenu="matMenu" class="currency-menu" xPosition="before">
          @for (cur of currencies; track cur) {
            <button mat-menu-item (click)="currency.set(cur)">
              <mat-icon>currency_exchange</mat-icon>
              {{ cur }}
            </button>
          }
        </mat-menu>
      </div>
    </div>

    <!-- === PRIMARY TOOLBAR (brand + big search + actions) === -->
    <mat-toolbar color="primary" class="toolbar">
      <!-- Mobile menu button -->
      <button mat-icon-button class="show-handset" (click)="drawer.toggle()" aria-label="Open menu">
        <mat-icon>menu</mat-icon>
      </button>

      <!-- Brand -->
      <a routerLink="/" class="brand-link">
        <mat-icon>shopping_bag</mat-icon>
        <span class="brand">{{ brand }}</span>
      </a>

      <!-- Big search -->
      <mat-form-field appearance="outline" class="search hide-handset">
        <mat-icon matPrefix>search</mat-icon>
        <input
          matInput
          placeholder="Search for products, brands and more"
          [matAutocomplete]="autoDesk"
          [formControl]="searchCtrl"
          (keyup.enter)="onSearchEnter()"
        />
      </mat-form-field>
      <mat-autocomplete #autoDesk="matAutocomplete">
        @for (s of filteredSuggestions(); track s) {
          <mat-option [value]="s">{{ s }}</mat-option>
        }
      </mat-autocomplete>

      <span class="spacer"></span>

      <!-- Action icons -->
      <button mat-icon-button routerLink="/offers" matTooltip="Offers" class="hide-handset">
        <mat-icon>local_offer</mat-icon>
      </button>

      <button
        mat-icon-button
        routerLink="/wishlist"
        [matBadge]="wishlistCount()"
        matBadgeSize="small"
        aria-label="Wishlist"
      >
        <mat-icon>favorite</mat-icon>
      </button>

      <button
        mat-icon-button
        routerLink="/cart"
        [matBadge]="cartCount()"
        matBadgeSize="small"
        aria-label="Cart"
      >
        <mat-icon>shopping_cart</mat-icon>
      </button>

      <button mat-icon-button [matMenuTriggerFor]="accountMenu" aria-label="Account">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #accountMenu="matMenu" xPosition="after" yPosition="below">
        <button mat-menu-item routerLink="/account">
          <mat-icon>person</mat-icon><span>My Account</span>
        </button>
        <button mat-menu-item routerLink="/orders">
          <mat-icon>receipt_long</mat-icon><span>Orders</span>
        </button>
        <button mat-menu-item routerLink="/wishlist">
          <mat-icon>favorite</mat-icon><span>Wishlist</span>
        </button>
        <mat-divider></mat-divider>
        @if (isLoggedIn()) {
          <div class="user-info">
            <span>{{ user()?.name }}</span>
          </div>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon><span>Logout</span>
          </button>
        } @else {
          <button mat-menu-item routerLink="/login">
            <mat-icon>login</mat-icon><span>Login</span>
          </button>
        }
      </mat-menu>
    </mat-toolbar>

    <!-- === SECONDARY NAV (mega) === -->
    <div class="nav-row hide-handset">
      <a mat-button routerLink="/">Home</a>

      @for (item of nav; track item.label) {
        @if (item.children?.length) {
          <!-- Scoped per-iteration menu -->
          <button mat-button class="nav-trigger" [matMenuTriggerFor]="menu" aria-haspopup="menu">
            @if (item.icon) {
              <mat-icon class="mr-1">{{ item.icon }}</mat-icon>
            }
            {{ item.label }}
            <mat-icon class="chev">expand_more</mat-icon>
          </button>

          <mat-menu #menu="matMenu" class="mega" yPosition="below" xPosition="before">
            <div class="mega-header">
              <h3>{{ item.label }}</h3>
            </div>
            <div class="mega-grid">
              @for (c of item.children; track c.label) {
                <a class="mega-card" [routerLink]="c.route">
                  <div class="mega-icon">
                    <mat-icon>{{ getCategoryIcon(c.label) }}</mat-icon>
                  </div>
                  <div class="mega-content">
                    <div class="mega-title">{{ c.label }}</div>
                    @if (c.description) {
                      <div class="mega-desc">{{ c.description }}</div>
                    }
                  </div>
                </a>
              }
            </div>
          </mat-menu>
        } @else {
          <a mat-button class="nav-link" [routerLink]="item.route">
            @if (item.icon) {
              <mat-icon class="mr-1">{{ item.icon }}</mat-icon>
            }
            {{ item.label }}
          </a>
        }
      }

      <span class="spacer"></span>
    </div>

    <mat-divider></mat-divider>
  </mat-sidenav-content>
</mat-sidenav-container>
